{"ast":null,"code":"var _jsxFileName = \"/home/honey/Desktop/Frontend/ManagementPortal-FE/src/views/layout/Layout.view.js\";\nimport { get } from 'lodash';\nimport axios from 'axios';\nimport PropTypes from 'prop-types';\nimport { connect } from 'react-redux';\nimport React, { Fragment, useEffect } from 'react';\nimport { withRouter, Redirect } from 'react-router-dom';\nimport AppRoutes from '../../AppRoutes';\nimport { getUser, refreshToken } from '../auth/auth.api';\nimport storage from '../../common/storage';\nimport { AUTH_ROUTES, USER_STATE } from '../../common/constants';\n\nconst Layout = ({\n  history,\n  location,\n  getUserFromApi,\n  isAuthenticated,\n  refreshToken\n}) => {\n  const adminAccess = () => {\n    const admin1 = get(storage.get('user'), 'user.typeOfId') === USER_STATE.ADMIN_FULL;\n    const admin2 = get(storage.get('user'), 'user.typeOfId') === USER_STATE.ADMIN_PARTIAL;\n    const employee = get(storage.get('user'), 'user.typeOfId') === USER_STATE.EMPLOYEE;\n    const admin = admin1 || admin2;\n    return {\n      admin,\n      employee\n    };\n  };\n\n  const {\n    admin,\n    employee\n  } = adminAccess();\n  console.log('admin...', admin);\n  console.log('employee...', employee); // const admin1 = get(storage.get('user'), 'user.typeOfId') === USER_STATE.ADMIN_FULL;\n  // const admin2 = get(storage.get('user'), 'user.typeOfId') === USER_STATE.ADMIN_PARTIAL;\n  // const admin = admin1 || admin2\n  // const employee = get(storage.get('user'), 'user.typeOfId') === USER_STATE.EMPLOYEE ;\n\n  useEffect(() => {\n    if (isAuthenticated && location && location.pathname && admin) {\n      history.push(AUTH_ROUTES.includes(location.pathname) ? '/dashboard' : location.pathname);\n    } else if (isAuthenticated && employee && location && location.pathname) {\n      history.push(AUTH_ROUTES.includes(location.pathname) ? '/employee' : '/employee');\n    } else if (!isAuthenticated && get(storage.get('user'), 'token')) {\n      getUserFromApi();\n    } // eslint-disable-next-line\n\n  }, [getUserFromApi, isAuthenticated, history]); // it will automatically sends refresh token if access token is not valid\n\n  axios.interceptors.response.use(function (response) {\n    return response;\n  }, function (error) {\n    if (error.response.status === 401) {\n      refreshToken();\n      window.location.reload();\n    }\n\n    return Promise.reject(error);\n  });\n  return [React.createElement(Fragment, {\n    key: \"redirect\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 71\n    },\n    __self: this\n  }, isAuthenticated && admin && React.createElement(Redirect, {\n    to: AUTH_ROUTES.includes(location.pathname) ? '/dashboard' : location.pathname,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 73\n    },\n    __self: this\n  }), isAuthenticated && employee && React.createElement(Redirect, {\n    to: AUTH_ROUTES.includes(location.pathname) ? '/employee' : '/employee',\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 82\n    },\n    __self: this\n  })), React.createElement(\"div\", {\n    key: \"app\",\n    id: \"app-wrapper\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 91\n    },\n    __self: this\n  }, React.createElement(AppRoutes, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 92\n    },\n    __self: this\n  }))];\n};\n\nLayout.defaultProps = {\n  isAuthenticated: false\n};\nLayout.propTypes = {\n  isAuthenticated: PropTypes.bool,\n  getUserFromApi: PropTypes.func,\n  history: PropTypes.object.isRequired,\n  location: PropTypes.object.isRequired,\n  refreshToken: PropTypes.func\n};\n\nconst mapStateToProps = state => ({\n  isAuthenticated: state.getIn(['auth', 'isAuthenticated'])\n});\n\nconst mapDispatchToProps = dispatch => ({\n  getUserFromApi: () => {\n    dispatch(getUser());\n  },\n  refreshToken: () => {\n    dispatch(refreshToken());\n  }\n});\n\nexport default withRouter(connect(mapStateToProps, mapDispatchToProps)(Layout));","map":{"version":3,"sources":["/home/honey/Desktop/Frontend/ManagementPortal-FE/src/views/layout/Layout.view.js"],"names":["get","axios","PropTypes","connect","React","Fragment","useEffect","withRouter","Redirect","AppRoutes","getUser","refreshToken","storage","AUTH_ROUTES","USER_STATE","Layout","history","location","getUserFromApi","isAuthenticated","adminAccess","admin1","ADMIN_FULL","admin2","ADMIN_PARTIAL","employee","EMPLOYEE","admin","console","log","pathname","push","includes","interceptors","response","use","error","status","window","reload","Promise","reject","defaultProps","propTypes","bool","func","object","isRequired","mapStateToProps","state","getIn","mapDispatchToProps","dispatch"],"mappings":"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","sourcesContent":["import { get } from 'lodash';\nimport axios from 'axios';\nimport PropTypes from 'prop-types';\nimport { connect } from 'react-redux';\nimport React, { Fragment, useEffect } from 'react';\nimport { withRouter, Redirect } from 'react-router-dom';\n\nimport AppRoutes from '../../AppRoutes';\nimport { getUser, refreshToken } from '../auth/auth.api';\nimport storage from '../../common/storage';\nimport { AUTH_ROUTES, USER_STATE } from '../../common/constants';\n\n\nconst Layout = ({\n  history,\n  location,\n  getUserFromApi,\n  isAuthenticated,\n    refreshToken,\n}) => {\n\n  const adminAccess = () => {\n    const admin1 = get(storage.get('user'), 'user.typeOfId') === USER_STATE.ADMIN_FULL;\n    const admin2 = get(storage.get('user'), 'user.typeOfId') === USER_STATE.ADMIN_PARTIAL;\n    const employee = get(storage.get('user'), 'user.typeOfId') === USER_STATE.EMPLOYEE ;\n    const admin = admin1 || admin2\n    return {admin, employee}\n  }\n\n  const { admin, employee } = adminAccess();\n\n  console.log('admin...', admin)\n  console.log('employee...', employee)\n\n  // const admin1 = get(storage.get('user'), 'user.typeOfId') === USER_STATE.ADMIN_FULL;\n  // const admin2 = get(storage.get('user'), 'user.typeOfId') === USER_STATE.ADMIN_PARTIAL;\n  // const admin = admin1 || admin2\n  // const employee = get(storage.get('user'), 'user.typeOfId') === USER_STATE.EMPLOYEE ;\n\n  useEffect(() => {\n    if (isAuthenticated  && location && location.pathname && admin) {\n      history.push(\n        AUTH_ROUTES.includes(location.pathname)\n          ? '/dashboard'\n          : location.pathname,\n      );\n    } else if (isAuthenticated && employee && location && location.pathname) {\n      history.push(\n          AUTH_ROUTES.includes(location.pathname)\n              ? '/employee'\n              : '/employee',\n      );\n    }else if (!isAuthenticated && get(storage.get('user'), 'token')) {\n      getUserFromApi()\n    }\n    // eslint-disable-next-line\n  },[getUserFromApi, isAuthenticated, history]);\n\n  // it will automatically sends refresh token if access token is not valid\n  axios.interceptors.response.use(function (response) {\n    return response;\n  }, function (error) {\n    if(error.response.status === 401) {\n      refreshToken();\n      window.location.reload();\n    }\n    return Promise.reject(error);\n  });\n\n  return [\n    <Fragment key=\"redirect\">\n      {isAuthenticated && admin && (\n        <Redirect\n          to={\n            AUTH_ROUTES.includes(location.pathname)\n              ? '/dashboard'\n              : location.pathname\n          }\n        />\n      )}\n      {isAuthenticated && employee && (\n          <Redirect\n              to={\n                AUTH_ROUTES.includes(location.pathname)\n                    ? '/employee'\n                    : '/employee'\n              }\n          />\n      )}\n    </Fragment>,\n    <div key=\"app\" id=\"app-wrapper\">\n      <AppRoutes />\n    </div>,\n  ];\n};\n\nLayout.defaultProps = {\n  isAuthenticated: false,\n};\n\nLayout.propTypes = {\n  isAuthenticated: PropTypes.bool,\n  getUserFromApi: PropTypes.func,\n  history: PropTypes.object.isRequired,\n  location: PropTypes.object.isRequired,\n  refreshToken: PropTypes.func,\n};\n\nconst mapStateToProps = (state) => ({\n  isAuthenticated: state.getIn(['auth', 'isAuthenticated']),\n});\n\nconst mapDispatchToProps = (dispatch) => ({\n  getUserFromApi: () => {\n    dispatch(getUser());\n  },\n  refreshToken: () => {\n    dispatch(refreshToken());\n  },\n});\n\nexport default withRouter(connect(mapStateToProps, mapDispatchToProps)(Layout));\n"]},"metadata":{},"sourceType":"module"}